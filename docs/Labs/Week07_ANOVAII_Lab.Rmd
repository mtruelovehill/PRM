---
title: "Week 7 Lab: ANOVA II"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
    css: https://mtruelovehill.github.io/PRM/Labs/css/style.css
runtime: shiny_prerendered
---


```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(kableExtra)

baseColor <- '#4CA384'
accent1 <- '#9AD079'
accent2 <- '#C4C6C7'
accent3 <- '#19424C'
```

## Intro to Today's Lab

During today's lab, you'll apply the concepts discussed during this week's lecture. Each lab consists of a range of tasks, with corresponding questions you can answer. Please note that the questions are not required and not marked, although they do provide a helpful source of formative feedback that will help you gauge your understanding. 

### Learning Objectives
At the end of this lab, you will be able to:

1. Identify hypotheses which may be tested using Factorial ANOVA
2. Check assumptions for a Factorial ANOVA
3. Use SPSS to perform Factorial ANOVAs
4. Run a power analysis for a Factorial ANOVA
5. Interpret and report results from Factorial ANOVAs



### This Week's Study
In this week's lab, you'll be working with data simulated based on [this paper](https://d1wqtxts1xzle7.cloudfront.net/92405721/vrtherapy-libre.pdf?1665701596=&response-content-disposition=inline%3B+filename%3DVirtual_Reality_Exposure_Therapy_for_the.pdf&Expires=1723672793&Signature=ceCWXs2EIQsAqYQSz5XM5-rSYxHeEbUHIDYv8cXqDjMrFK6~6PO-5bD05ku0EWCSZaCFaKHER1atUcfjFGUASRZ6L5aij5dBBtF~HV7f3QH70Diq~2P4MXCA5KMJYq9tWPWv4My7b~T5vLnSWGHDI9XYFfEqg7dMPBibKUtaiVTmVekzvXVQwt~E4m0cuVcA1j6KLe3nC6kfGRbO20EMfVZeCLW6f-3M5K3gr~xPnnQBjX7V3m97pJ6FoY8S9SbJzJQiyIGYe1DIh0BIYx-cV7O-a9D~Je8fQrg1wNmBhWdTLJu4h6m3SIop9B-HSTIcW0LmHlxp2SltefXxHSRukA__&Key-Pair-Id=APKAJLOHF5GGSLRBV4ZA). In this study, researchers tested the effectiveness of a virtual reality-based exposure therapy to treat PTSD in victims of the September 11th attacks. Participants were given the Clinician-Administered PTSD Scale (CAPS) and assigned to either a waitlist or treatment group. After the treatment group completed therapy, all participants were once again administered the CAPS.


## Study Overview

In this experiment, you'll be testing the effectiveness of a virtual reality-based exposure therapy to treat PTSD using a sample of victims of the September 11th attacks. Participants were given the Clinician-Administered PTSD Scale (CAPS) and assigned to either a waitlist or treatment group. After the treatment group completed therapy, all participants were once again administered the CAPS. In order to determine the effectiveness of the treatment, the following three effects must be tested:

**Main Effect 1:** Is there a significant difference in CAPS scores of PTSD patients between the treatment and waitlist groups?

**Main Effect 2:** Is there a significant difference in CAPS scores of PTSD patients between baseline and follow-up sessions?

**Interaction Effect:** Does the effect of time on CAPS scores of PTSD patients change depending upon treatment group?


You can download the data for this week's lab [here.](https://mtruelovehill.github.io/PRM/Labs/ANOVAIILabData.sav)

This dataset contains the following variables:

```{r, echo = F}
dat <- read.csv('https://mtruelovehill.github.io/PRM/Labs/ANOVAIILabData.csv')
datInfo <- data.frame(VariableName=colnames(dat), 
                      Description=c('Age in years', 'Sex', 'Levels: 0 = Waitlist; 1 = VR Therapy', 'pre-intervention CAPS score (possible values = 0-80)', 'post-intervention CAPS score (possible values = 0-80)'))

datInfo %>%
  kbl(col.names=c('Variable Name', 'Description')) %>%
  kable_styling(full_width = F) %>%
  row_spec(0, bold = T, color=baseColor, font_size = 18, align='l') %>%
  column_spec(1, bold = T, width = '4.5cm')
```


```{r tyo1, echo = FALSE}
quiz(caption = '',
     question("Which test is most appropriate to address your research question, given the study design?",
              answer("One-Way ANOVA"),
              answer("Repeated-Measures ANOVA"),
              answer("Factorial ANOVA", correct = T),
              answer("You will need to run multiple tests to address the research question."),
              message = "While all of these tests are appropriate for use with categorical independent variables and continuous dependent variables, only the multiway ANOVA can test the effects of multiple independent variables at once. Here, you have 2 independent variables: Time (Baseline vs Follow-Up) and Treatment Group (VR Therapy vs Waitlist)."),
     question("What kind of variable is Treatment Group?",
              answer("Between-Subjects", correct = T),
              answer("Within-Subjects"),
              message = 'Treatment Group is a between-subjects variable, because each individual is only placed in one group. There is no sample overlap between the Waitlist and Treatment groups.'),
     question("What kind of variable is Time?",
              answer("Between-Subjects"),
              answer("Within-Subjects", correct = T),
              message = 'Time is a within-subjects variable, because all participants provided data at both baseline and follow-up.'))
```

### Your Tasks

<div class="nobullet">

+ [ ] $\ $ Identify your independent and dependent variables for this experiment. 
+ [ ] $\ $ State your hypotheses for this experiment, both using words and statistically.

</div>

Note that the research questions have already been specified, above.
<br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

To state hypotheses statistically, you should structure them in the framework of the statistical values being tested.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

<b>Independent Variables:</b> Time (2 levels: Baseline/Follow-up); Treatment Group (2 levels: Waitlist/VR Therapy)

<b>Dependent Variable:</b> CAPS score

<br>

<b>Hypotheses:</b>

<i> General: </i>

**Main Effect 1**

$H_0:$ There will be no effect of Treatment Group on CAPS Score

$H_1:$ There will be an effect of Treatment Group on CAPS Score

**Main Effect 2**

$H_0:$ There will be no effect of Time on CAPS Score

$H_1:$ There will be an effect of Time on CAPS Score

**Interaction**

$H_0:$ The effect of Time on CAPs score will not dependent upon Treatment Group.

$H_1:$ The effect of Time on CAPS score is dependent upon Treatment Group.


<i> Statistical: </i>

**Main Effect 1**

$H_0: \mu_{waitlist} = \mu_{VRtherapy}$

$H_1: \mu_{waitlist} \neq \mu_{VRtherapy}$

**Main Effect 2**

$H_0: \mu_{baseline} = \mu_{follow-up}$

$H_1: \mu_{baseline} \neq \mu_{follow-up}$

**Interaction Effect**

$C = (\mu_{baseline}\times\mu_{waitlist}-\mu_{baseline}\times\mu_{therapy})-(\mu_{follow-up}\times\mu_{waitlist}-\mu_{follow-up}\times\mu_{therapy})$

$H_0: C = 0$

$H_1: C \neq 0$

</details>
</div>
</br>


## Power Analysis
<br>

Recall the effect size measure for ANOVA, $\eta^2$:

```{r, echo = F}

eta2Tab <- data.frame(Strength = c('Weak', 'Moderate', 'Strong'), Magnitude = c(.01, .06, .14))

eta2Tab %>%
  kbl(col.names=c('Variable Name', paste('Magnitude of', "$\\eta^2$"))) %>%
  kable_styling(full_width = F) %>%
  row_spec(0, bold = T, color=baseColor, font_size = 16, align='l') %>%
  column_spec(1, bold = T, width = '4.5cm')
```

### Your Task

<div class="nobullet">

+ [ ] $\ $ Run an a priori power analysis using $\alpha$ = .05 and power = .8 to determine the sample size necessary to detect a moderate ( $\eta^2$ = .06) interaction effect between `TherapyGroup` and `Time` on CAPS score. 

</div>


There are many possible measures of effect size that are used across statistical tests. The software that we use to run power analyses, WebPower, uses $f$ as its measure of effect size for ANOVA. SPSS uses $\eta^2$, so we need to convert $\eta^2$ to $f$ before running the power analysis. You can do this with the following equation:

$$f = \sqrt{\frac{\eta^2}{1-\eta^2}}$$

You can convert $f$ to $\eta^2$ with this equation:

$$\eta^2 = \frac{f^2}{1+f^2}$$

Be sure to use $f$ when entering the effect size into WebPower and $\eta^2$ when interpreting your results. 

**VERY IMPORTANT NOTE:** $f$ is NOT the same as the $F$-statistic we compute when running an ANOVA. These are different values entirely. Bonkers, I know. Statisticians aren't the most creative namers.

Click [here to use WebPower to run your analysis](https://webpower.psychstat.org/wiki/models/index).


```{r cyrPower, echo = FALSE}
quiz(caption = 'Check Your Results',
    question_numeric("How many participants do you need to detect a moderate interaction effect with 80% power and alpha = .05?",
                      answer(128, correct = T),
                      message = "You would need 128 total participants to detect the interaction effect, given the above constraints."))

```

```{r cyrPower2, echo = FALSE, eval = F}
quiz(caption = 'Check Your Results',
     question_numeric("What is the numerator df associated with the interaction effect?",
                      answer(1, correct = T),
                      message = "The numerator df for the interaction is 1. See the solution tab for information on how this is calculated."),
     question_numeric("How many participants do you need to detect a moderate interaction effect with 80% power and alpha = .05?",
                      answer(128, correct = T),
                      message = "You would need 128 total participants to detect the interaction effect, given the above constraints."),
     question_numeric("What is the minimum effect of TherapyGroup you can detect with 100 participants, 80% power, and alpha = .05? Please give your answer in eta-squared to 2 decimal places.",
                      answer(0.07, correct = T),
                      message = "You can detect a moderate effect (eta-squared = .07) with 100 participants under these constraints. An eta-squared of .07 is equivalent to f = .28."))

```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>
<br>

Consider whether your independent variables are between-subjects, within-subjects, or a mix. This will impact which power analysis option you choose. The 'Two-Way and Three-Way ANOVA with interaction' option is meant for use with between-subjects variables, while the 'Repeated Measures ANOVA' should be used if you have any within-subjects variables.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>
<br>


<span style = "font-weight: bold; font-size: 14pt"> Interaction Effect </span>

Navigate to the WebPower site and click 'Repeated-Measures ANOVA'.


<i> Number of groups </i> refers to the number of independent (between-subjects) groups you're comparing. In this case, the independent groups are the 2 groups captured by the `Treatment` variable: Waitlist & VR Therapy.

<i> Number of measurements </i> refers to the number of measurements you're taking within each group (within-subjects). Here, two measures are taken from each group: one at baseline, and one at follow-up (captured by the `Time` variable).


You'll leave the Sample Size option blank, as that's the value you want to calculate. 

To compute the effect size, $f$, you'll do the following:

$$f = \sqrt{\frac{.06}{1-.06}} = .25$$
You can enter in the appropriate values for $\alpha$ and power. Make sure that 'Type of Effect' is set as 'interaction effect'. When you're finished, click 'Calculate' and you should see the following results if you've entered everything properly:

```{r, echo = F, fig.align='center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_powerOptions.png')
```

To detect an interaction effect with the given constraints, you need 128 participants.

</details>
</div>

## Data Review

Before running any analyses, you should first check your data. In many cases, some kind of cleaning or data wrangling will be necessary. For instance, are there any missing values? Do you have any unexpected values or extreme outliers? Do you need to create a variable from the existing data (e.g., a summary metric for a cognitive task)? These things should be dealt with before conducting the analyses.

Additionally, you'll need to compute descriptive data. You'll do this for both your main variables of interest and your sample's demographic data, as this must be included in the Sample portion of your Methods section. 

### Your Tasks

<div class="nobullet">

+ [ ] $\ $ Open 'Week6LabData1.sav'

+ [ ] $\ $ Check whether all variables imported into SPSS as the correct measurement type. 

+ [ ] $\ $ Add labels to `TherapyGroup`: 0 = 'Waitlist'; 1 = 'VR Therapy'

+ [ ] $\ $ Check the descriptive statistics of your data.

+ [ ] $\ $ Produce the proper plot to visualise the distribution of your continuous variables, `Age`, `CAPSBaseline`, and `CAPSFollowUp`.

</div>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

For continuous variables, the descriptive statistics you'll want to check are mean and standard deviation. It's also useful to check the minimum and maximum so you can easily identify values outside of your expected range. For categorical variables, you'll check the frequency of participants in each group.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

<span style = "font-weight: bold; font-size: 14pt"> Adjust Variable Measure Format </span>

To check that your variables are labeled as the correct scale of measurement, look at the **Measure** column under the *Variable View* tab.

* `Age` - Scale

* `Gender` - Nominal

* `TherapyGroup` - Nominal

* `CAPSBaseline` - Scale

* `CAPSFollowUp` - Scale

In this instance, SPSS assigned the proper measures by default. No changes are required.

<br>

<span style = "font-weight: bold; font-size: 14pt"> Add Labels to `TherapyGroup` </span>

To associate a label with each value of a variable, you'll use the **Values** column under the **Variable View** tab.

Select the TherapyGroup x Values cell and click the dots to bring up the _Value Labels_ box. Use the $+$ to add a new label. In the Value column, type 0, then in the Label column, type 'Waitlist'. Repeat the process for the VR Therapy group. 

<span style = "font-weight: bold; font-size: 14pt"> Check Descriptive Statistics & Produce Distribution Plots </span>

**Categorical Variables:** Your categorical variables are `TherapyGroup` and `Gender`. Click *Analyze>Descriptive Statistics>Frequencies*, then add these two variables to the 'Variable(s)' box. Make sure 'Display frequency tables' is checked, then click 'OK'. You should see the following output:

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_updateFreqTables.png')
```

Note that if you set up the labels for the `TherapyGroup` properly, these will appear in the frequency tables, rather than the numeric values you see in 'Data View'. 

**Continuous Variables:** Your categorical variables are `Age`, `CAPSBaseline`, and `CAPSFollowUp`. Click *Analyze>Descriptive Statistics>Frequencies*, then add these variables to the 'Variable(s)' box. Make sure 'Display frequency tables' is not ticked, then click 'Statistics'. Tick 'Mean', 'Std. Deviation', 'Minimum', and 'Maximum'. Click 'Continue', then click 'Charts'. As these are continuous variables, you will visualise them using histograms. Click 'Histogram', then tick 'Show normal curve on histogram'. Click 'Continue' and then 'OK'. 

```{r, echo = F, fig.align= 'center', out.width = '40%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_updateDescStat.png')
```

Here, you can have a look at your continuous variables' distributions. There are no concerning outliers or unusual values. Your age variable isn't normally distributed, but as its not one of the variables being tested, this doesn't matter. In fact, a uniform age distribution indicates you're getting a good range of people from each age group in your sample.

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_ageHist.png')
```

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_baselineHist.png')
```

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_followUpHist.png')
```


</details>
</div>
</br>

## Check Assumptions

The requirements/assumptions of a Factorial ANOVA are:

(1) **Normality:** Residuals are normally distributed

(2) **Independence of Observations:** Individual observations should not be dependent upon any others

(3) **Homogeneity of Variance:** Variances within each level combination should be generally similar

(4) The dependent/outcome variable must be continuous and the independent/predictor variables must be categorical

### Your Tasks

<div class="nobullet">

+ [ ] $\ $ Decide whether your data meet the assumption of normality

+ [ ] $\ $ Decide whether your data meet the assumption of independence

+ [ ] $\ $ Decide whether your data meet the assumption of homogeneity

</div>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Have a look at the [lecture slides](https://mtruelovehill.github.io/PRM/Lectures/Week06_ANOVAII_lecture.html) if you're lost.

You'll need to run the ANOVA in order to test the assumptions of normality and homogeneity. As you need to test normality using the residuals, you'll need to click the 'Save' button to produce Standardised Residuals when the test is run. To test homogeneity, you'll be checking Levene's test.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

To check the assumptions of normality and homogeneity, you'll need to run your ANOVA. See the Solution tab in [Primary Analysis] if you need a step-by-step guide on setting up your test. Once you have your test set up, click the 'Save' option, and tick the Residuals box beside 'Standardized'.

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_testSetupSave.png')

knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_residuals.png')
```

This will produce new two new columns that reflect the residuals from your model. Click 'Continue', then 'Options'. Tick the box next to 'Homogeneity tests' to run Levene's test. Click 'Continue' then 'OK'. 

<span style = "font-weight: bold; font-size: 14pt"> Normality </span>

To check normality, you'll produce histograms and Q-Q plots using the two new residual columns you created. Navigate to *Analyze>Descriptive Statistics>Frequencies* and add the two residual columns to the 'Variable(s)' box. Click 'Charts', then 'Histograms' and tick 'Show normal curve on histogram'. Click 'Continue' and 'OK'. 

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_histRes1.png')

knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_histRes2.png')
```

These look generally normal. There's a slight point in the right tail of the Baseline residuals that isn't quite normal, but it's not problematic. The Q-Q plots can also be checked. Navigate to *Analyze>Descriptive Statistics>Q-Q Plots* and add the two residual columns to the 'Variable(s)' box. Click 'OK'. 

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_qqRes1.png')

knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_qqRes2.png')
```

The Q-Q plots show no major violations of normality, so the assumption of normality can be considered to be met.

<span style = "font-weight: bold; font-size: 14pt"> Homogeneity of Variance </span>

To check the homogeneity assumption, you can interpret the results of Levene's test in your output:

```{r, echo = F, fig.align= 'center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_levenesTest.png')
```

You'll check the rows that say 'Based on Mean'. All $p$-values are greater than the $\alpha$ threshold of .05, so the tests are not significant. This means that the assumption of homogeneity is met. 

<span style = "font-weight: bold; font-size: 14pt"> Independence </span>

Assessing independence requires you to have an understanding of the conditions under which your data were collected. Between-subjects study designs increase the likelihood that the observations are independent of each other. Additionally, using an appropriate analysis for within-subjects variables (such as a repeated-measures ANOVA) ensures you're accounting for within-subjects variance, so you can consider this assumption to be met.

</details>
</div>

## Primary Analysis

As you are testing the effect of two independent variables on a dependent variable, you'll use results from a Factorial ANOVA with one between-subjects variable (`TherapyGroup`) and one within-subjects variable (Time: Baseline and Follow-up) to provide statistical support for your hypotheses. Recall that you're testing the following effects:

**Main Effect 1**

$H_1: \mu_{waitlist} \neq \mu_{therapy}$

**Main Effect 2**

$H_1: \mu_{baseline} \neq \mu_{follow-up}$

**Interaction Effect**

$C = (\mu_{baseline}\times\mu_{waitlist}-\mu_{baseline}\times\mu_{therapy})-(\mu_{follow-up}\times\mu_{waitlist}-\mu_{follow-up}\times\mu_{therapy})$

$H_1: C \neq 0$

### Your Tasks

<div class="nobullet">

+ [ ] $\ $ Run a Factorial ANOVA to test your hypotheses and interpret the results with $\alpha$ = .05.

+ [ ] $\ $ Compute the effect sizes associated with your analysis

</div>

```{r cyrFacAOV, echo = FALSE}
quiz(caption = 'Check Your Results',
     question_numeric("What is the F-statistic associated with main effect 1 (Therapy Group)? Please round your answer to two decimal places.",
              answer(6.90, correct = T),
              message = "The F-statistic associated with this test is 6.90. You'll find this in the 'Tests of Between-Subjects Effects' table."),
     question("Is the effect of Time (main effect 2) significant?",
              answer('Yes'),
              answer('No', correct = T),
              message = "The p-value associated with Time can be found in the 'Tests of Within-Subjects Effects' table. It is .076, which is larger than the alpha threshold of .05, indicating the effect of Time is not significant."),
     question_numeric("What is the effect size (partial eta-squared) associated with the interaction effect (Therapy Group x Time)? Please round your answer to two decimal places.",
              answer(0.12, correct = T),
              message = "The effect size associated with the interaction effect is 0.12. You'll find this in the 'Tests of Within-Subjects Effects' table."))
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

To run a Factorial ANOVA with a within-subjects variable, you should navigate to *Analyze>General Linear Model>Repeated Measures*. If you only had between-subjects variables, you would navigate to *Analyze>General Linear Model>Univariate*.

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Navigate to *Analyze>General Linear Model> Repeated Measures*. Your repeated measure variable is time, and there are two levels (Baseline and Follow-up) so set it up accordingly.  Add the name of your measure (CAPS) if you'd like.

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_RMfactors.png')
```

Click 'Define', then add your Within-Subjects Variables, `CAPSBaseline` and `CAPSFollowUp`,  and your Between-Subjects Variable, `TherapyGroup`. 

Now that you've added your variables, you can set up some other options for your analysis. In order to help you visualise your results, it's helpful to look at a plot. Click 'Plots', then add `Time` to the 'Horizontal Axis' box (this sets the x-axis of your plot), and `TherapyGroup` to the 'Separate Lines' box. Click 'Add', and the plot will appear in the 'Plots:' box below. Make sure 'Line Chart' is selected and the 'Include Error Bars' box is ticked. I also like to tick 'Include reference line for grand mean', so that the mean of the dependent variable across all groups is shown. 

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_modelPlot.png')
```

Click 'Continue', then click the 'EM Means' button to set up the simple effects analysis so that the interaction can be more easily interpreted. Add the interaction term ('TherapyGroup*Time') to the 'Display Means For:' box, then tick 'Compare simple main effects'. To avoid Type I error inflation, you can use the confidence interval adjustment option. I default to 'Bonferroni'. It's more conservative (slightly higher chance of Type II error), but it also doesn't have the assumptions of Sidak, so it can be used more generally.

```{r, echo = F, fig.align= 'center', out.width = '50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_emMeans.png')
```

Click 'Continue'. If you haven't already, you'll need to produce the residuals from your model so that you can check normality. Click 'Save', then tick the Residuals box beside 'Standardized'. See [Check Assumptions] for more information.

Finally, click 'Options', and select 'Descriptive Statistics' and 'Estimates of Effect Size'. Click 'Continue' and then 'OK' to run your model.

There's a lot of output to review (some of which you can ignore). 

The Descriptive Statistics box provides the mean, $SD$, and $n$ for each possible combination of variables:

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_FAdescStats.png')
```

You can ignore the multivariate tests table. You can also skip Mauchly's test. Because you only have 2-levels of your within-subjects variable (`Time`), sphericity is assumed. Sphericity only needs to be tested when you have 3 or more levels.

Have a look at the 'Tests of Within-Subjects Effects' table. Here, you can review the main effect of `Time`, as well as the interaction between `Time` and `TherapyGroup`. You can interpret the 'Sphericity Assumed' rows, since that assumption has been met. 

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_wsEffects.png')
```

The main effect of `Time` is not significant, as the $p$-value associated with this test (.076) is greater than our $\alpha$ threshold of .05. However, the interaction between `Time` and `Therapy` group is significant.

To check the main effect of `TherapyGroup`, have a look at the 'Tests of Between-Subjects Effects' table:

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/week6_bsEffects.png')
```

This main effect is significant ($p$ = .010). However, while we can acknowledge it as being significant, we don't typically interpret the main effect in the case of a significant interaction.

To better understand the interaction, have a look at the Estimated Marginal Means Tables; specifically, have a look at the results under '1. TherapyGroup*Time' section.

The 'Estimates' table gives similar information to the previously-discussed 'Descriptive Statistics' table, but the 'Pairwise Comparisons' and 'Univariate Tests' table provide more information.

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_interaction.png')
```

The 'Pairwise Comparisons' table shows you the difference in `CAPS` between therapy groups at each level in `Time`. Specifically, at baseline, CAPS scores from participants on the waitlist were only .48 points higher than those in the therapy group. This difference was not significant ($p$ = .834; see the full ANOVA results for this comparison in the 'Univariate Tests' table in the Time 1 row), so we can consider the scores between the two therapy groups generally equal at baseline. 

However, at follow-up, the mean CAPS score in the VR therapy group was 10.71 points lower than the mean CAPS score in the waitlist group. This difference was significant ($p$ < .001; see the full ANOVA results for this comparison in the 'Univariate Tests' table in the Time 2 row).

To visualise these results, have a look at the 'Profile Plots' output:

```{r, echo = F, fig.align= 'center', out.width = '75%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_interactionPlot.png')
```


</details>
</div>
</br>



## Interpret & Report 

Now that you've completed the analyses, write a mini results section describing your findings. In this section, please:

+ Give a brief description of your sample as you would in a methods section. 

+ Report your results and a provide interpretation in APA style. 


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

There are many ways you could write this up, but you'll need to at least include the following information:

+ alpha level
+ power analysis information (including effect size, sample size, power, and alpha)
+ number of participants (n)
+ participant demographics (mean age, age sd, and age range of sample; gender distribution of sample)
+ results from assumptions checks
+ descriptive data for each IV group (M and SD)
+ the type of test used
+ power analysis results
+ independent and dependent variables tested
+ type of independent variables (between- or within-subjects)
+ $F$-statistic
+ degrees of freedom
+ p-values
+ effect sizes

When reporting a factorial ANOVA, you should specify the ANOVA as a JxK Factorial ANOVA, where J reflects the number of levels in your first independent variable, and K reflects the number of variables in your second independent variable.

Remember that the proper style of reporting the results from an ANOVA looks like this:

$F$([between groups $df$], [within groups $df$]) = [$F$-statistic], $p$ = [$p$-value], $\eta^2$ = [$\eta^2$ value].

Note that the numbers inside the curly brackets refer to the degrees of freedom. ANOVA has two types of $df$ that should be reported. Please refer to the [lecture slides](https://mtruelovehill.github.io/PRM/Lectures/Week06_ANOVAII_lecture.html) for a specific example.

</details>
</div>
</br>


## Bonus Material: ANCOVA

Sometimes, there may be variables that are not directly relevant to your main analysis, but may still have an effect on the dependent variable. For example, a study that is looking at how phone usage affects attention span in children and adolescents may control for age. This is because it is well-established that one's attention span changes as they age, so the researcher would want to be sure that their results reflect the true relationship between phone use and attention span, rather than age and attention span.

Variables that may have an influence on the dependent variable, but are not part of your primary analysis are called **covariates**. You can control for covariate effects by including them in your model. One model that can be used in this way is called **ANCOVA**, or Analysis of Covariance. 

### Your Task

<div class="nobullet">

+ [ ] $\ $ Run an ANCOVA by adding `Age` as a covariate to the 2x2 ANOVA model you've been working with in this lab (with `Time` and `TherapyGroup` as IVs and CAPS score as the DV). 

</div>

<br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

To run an ANCOVA with your current model (2x2 Factorial ANOVA with one between- and one within-subjects independent variable), you can navigate to *Analyze>General Linear Model>Repeated Measures*.

If your original model only contained between-subjects variables, you would use *Analyze>General Linear Model>Multivariate* instead.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

To run an ANCOVA with a model with a within-subjects variable, navigate to *Analyze>General Linear Model>Repeated Measures*. Set up your IV and DVs as before (see the solution in [Primary Analysis] if you're unsure about this step). After you've added your variables, add `Age` to the 'Covariates' box:

```{r, echo = F, fig.align='center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_ANCOVAsetup.png')
```


You can set your model using the same options as in [Primary Analysis]. When you're ready, click 'OK' to run the model.

```{r, echo = F, fig.align='center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/anovaII_ANCOVAwsEffects.png')
```

You'll see that `Age` has been added to the results tables. 

```{r, echo = F, fig.align='center', out.width='50%'}
knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/Week6_ANCOVAbsEffects.png')
```

If you compare the results of your key variables (`Time` and `TherapyGroup` on CAPS score), you'll notice that the values have changed slightly, but the effects have remained the same. There is still a significant effect of `TherapyGroup`, and there is still a significant interaction. However, the numeric results are slightly different. This is because these results reflect the effect of your IVs on your DV, when `Age` is held constant. In other words, you're controlling for the effect of `Age`. 

While in this case, the results did not change much, sometimes the effect of a covariate can drastically alter the model results. You should always carefully consider which covariates are important to include when planning your study and analysis, as this could have a major impact on your final outcome.

When interpreting results from ANCOVA, you should focus on the variables about which you've hypothesised (i.e., your IVs and DV). It's okay to briefly report whether or not your covariates are significant, but they should not be a strong focus of your results/discussion, and you only need to report the $p$-values. If there is a strong covariate effect and you think this has affected your hypothesised results, you might consider discussing it further in the discussion section, but it should be done in the context of your research aim and hypothesis. 

</details>
</div>
</br>
