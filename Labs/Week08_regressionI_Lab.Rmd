---
title: "Week 8: Regression I"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
    css: https://mtruelovehill.github.io/PRM/Labs/css/style.css
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(kableExtra)
library(plotly)
library(shiny)

baseColor <- '#4CA384'
accent1 <- '#9AD079'
accent2 <- '#C4C6C7'
accent3 <- '#19424C'
```




```{r, echo = F}
tags$style(HTML(".js-irs-0 .irs-single, .js-irs-0 .irs-to, .js-irs-0 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-1 .irs-single, .js-irs-1 .irs-to, .js-irs-1 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-2 .irs-single, .js-irs-2 .irs-to, .js-irs-2 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-3 .irs-single, .js-irs-3 .irs-to, .js-irs-3 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-4 .irs-single, .js-irs-4 .irs-to, .js-irs-4 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-5 .irs-single, .js-irs-5 .irs-to, .js-irs-5 .irs-bar {background: #4CA384}"))
```

## Intro to Today's Lab

During today's lab, you'll apply the concepts discussed during this week's lecture. Each lab consists of a range of tasks, with corresponding questions you can answer. Please note that the questions are not required and not marked, although they do provide a helpful source of formative feedback that will help you gauge your understanding. 

### Learning Objectives
At the end of this lab, you will be able to:

1. Understand what is meant by 'intercept' and 'slope'
2. Identify hypotheses which may be tested using regression
3. Test the assumptions of a regression
4. Use SPSS to run multiple linear regression
5. Properly interpret and report multiple linear regression analysis
6. Run a power analysis for linear regression


## Introduction to Regression

INTRO TO ACTIVITY HERE.

```{r regPlot, echo = F}

fluidRow(column(4, sliderInput('int1', 'Line 1 Intercept', min = -4, max = 4, step = 1,
                               value = 0, ticks = F),
                sliderInput('slope1', 'Line 1 Slope', min = -3, max = 3, step = 0.5,
                               value = 0, ticks = F)),
         column(4, sliderInput('int2', 'Line 2 Intercept', min = -4, max = 4, step = 1,
                               value = 0, ticks = F),
                sliderInput('slope2', 'Line 2 Slope', min = -3, max = 3, step = 0.5,
                               value = 0, ticks = F)),
         column(4, sliderInput('int3', 'Line 3 Intercept', min = -4, max = 4, step = 1,
                               value = 0, ticks = F),
                sliderInput('slope3', 'Line 3 Slope', min = -3, max = 3, step = 0.5,
                               value = 0, ticks = F)))

plotlyOutput('regPlot')
```

```{r, context = 'server'}
output$regPlot <- renderPlotly({
  ggplot() + 
  scale_y_continuous(limits = c(-20, 20)) +
  scale_x_continuous(limits = c(0, 5)) + 
  labs(x = 'X', y = 'Y') +
  geom_abline(slope = input$slope1, intercept = input$int1, color = baseColor, linewidth = 1) +
  geom_abline(slope = input$slope2, intercept = input$int2, color = accent1, linewidth = 1) +
  geom_abline(slope = input$slope3, intercept = input$int3, color = accent3, linewidth = 1) +
  geom_vline(xintercept = 0, lty = 2) +
  theme(axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_text(size = 14, face = 'bold'),
        axis.text.x = element_text(size = 12)) +
    annotate(geom = 'Text', label = 'Line 1', color = baseColor, x = .5, y = 15, size = 6) +
    annotate(geom = 'Text', label = 'Line 2', color = accent1, x = .5, y = 12, size = 6) +
    annotate(geom = 'Text', label = 'Line 3', color = accent3, x = .5, y = 9, size = 6)
    })
```

## Experiment Overview

<br>
You'll be working with data adapted from [this study](https://www.tandfonline.com/doi/pdf/10.1080/19496591.2016.1157488?casa_token=KqqNSiTRoRsAAAAA:QhO9mJDVherxFrqUfdQhgLIeqbccw9HNTyB0Z3Ef3lQOKjmw6UPAETyUw6HBoC_XhIhf9rnytNmk) in which the researchers investigated the factors associated with well-being in University students. 

In this experiment, you recruited a sample of university students and administered several scales to capture your variables of interest. Specifically, you measured participants' well-being, their level of social support, their weekly physical activity, and their sleep per week. On each variable, higher scores correspond to higher levels.

You can download the dataset from this experiment [here](https://mtruelovehill.github.io/PRM/Labs/Week8LabData.sav). It contains the following variables:

```{r, echo = F}
dat <- read.csv('https://mtruelovehill.github.io/PRM/Labs/Week8LabData.csv')

datInfo <- data.frame(VariableName = colnames(dat),
                      Description=c('Age in years',
                                    'Levels: Female; Male; Nonbinary; Other; Prefer not to Disclose',
                                    'Amount of physical activity per week in hours',
                                    'Amount of sleep per week in hours',
                                    'Scores on a social support scale; values may range between 0-45',
                                    'Scores on a well-being scale; values may range between 0-40'))

datInfo %>%
  kbl(col.names=c('Variable Name', 'Description')) %>%
  kable_styling(full_width = F) %>%
  row_spec(0, bold = T, color=baseColor, font_size = 18, align='l') %>%
  column_spec(1, bold = T, width = '4.5cm')
```

You'll be investigating whether physical activity, sleep, and social support predict students' wellbeing. 

```{r cyu1, echo = FALSE}
quiz(caption = '',
     question("Which test is most appropriate to address your research question, given the study design?",
              answer("Simple Linear Regression"),
              answer("Factorial ANOVA"),
              answer("Pearson Correlation"),
              answer("Multiple Linear Regression", correct = T),
              message = "Here, you're looking at whether several continuous variables predict values on another continuous variables. Both a t-test and a Factorial ANOVA require a categorical dependent variable, and a Pearson correlation only looks at the association between two continuous variables. A simple linear regression is one in which a single variable predicts an outcome, and here there are 3 predictors. In this case, multiple linear regression is the best option."),
     question("Which of the following questions can be addressed using linear regression? Please select all that apply.",
              answer('What is the association between age in years and weight in kg?', correct = T),
              answer('Is there a difference in vaping rates by age group?', correct = T),
              answer('Is there an association between season (Spring, Summer, Autumn, Winter) and the number of cyclists on the path through the Meadows?', correct = T),
              answer('Are scores on the Beck Depression Inventory associated with weekly physical activity (in hours)?', correct = T),
              answer('Can scores on a standardised test predict University marks?', correct = T),
              answer('Can the number of sweets one consumes per month predict the presence or absence of tooth decay?'),
              random_answer_order = T,
              message = "Linear regression can actually address almost all of these questions. It's super flexible! In SPSS, however, it's a bit more complex to do regression analyses with categorical predictors, so in this course, we've been using ANOVA. The only research question that cannot be tested with linear regression is 'Can the number of sweets one consumes per month predict the presence or absence of tooth decay?', as this has a binary outcome variable (Tooth Decay: Yes/No). In the case of binary outcomes, a linear model is not appropriate; instead, you should use logistic regression."))
```

### Your Tasks
+ [ ] $\ $ State your research question(s) for this experiment.
+ [ ] $\ $ Specify the predictor and outcome variables.
+ [ ] $\ $ State your hypotheses for this experiment, both using words and statistically.


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

With regression, it's common to refer to variables as predictors and outcomes rather than independent and dependent variables. However, the predictor variables equate to the independent variables, and the outcome equates to the dependent variable.

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

<b>Possible Research Questions:</b>

Do physical activity, sleep, and social support significantly predict well-being in university students? 

<br>

<b>Predictors:</b> Physical Activity; Sleep; Social Support 

<b>Variable 2:</b> Well-being

<br>

<b>Hypotheses:</b>

<i> General: </i>

Here is an example of the overall hypothesis: 

$H_0:$ Sleep, physical activity, and social support do not predict well-being in university students.

$H_1:$ Sleep, physical activity, and social support significantly predict well-being in university students.


Here is an example of a specific hypothesis:

$H_0:$ Sleep does not predict well-being in university students when controlling for the effects of physical activity and social support.

$H_1:$ Sleep predicts well-being in university students when controlling for the effects of physical activity and social support.

<i> Statistical: </i>

$H_0: \beta_{x_i} = 0$

$H_1: \beta_{x_i} \neq 0$

</details>
</div>
</br>


## Data Review

Before running any analyses, you should first check your data. In many cases, some kind of cleaning or data wrangling will be necessary. For instance, are there any missing values? Do you have any unexpected values or extreme outliers? Do you need to create a variable from the existing data (e.g., a summary metric for a cognitive task)? These things should be dealt with before conducting the analyses.

Additionally, you'll need to compute descriptive data. You'll do this for both your main variables of interest and your sample's demographic data, as this must be included in the Sample portion of your Methods section. 

### Your Tasks

+ [ ] $\ $ Open 'Week8LabData.sav'

+ [ ] $\ $ Check that all variables are set as the correct measurement type. 

+ [ ] $\ $ Check the descriptive statistics of your data

```{r cyrDesc, echo = FALSE}
quiz(caption = 'Check Your Results',
     question_numeric("How many total participants are there in this dataset?",
              answer(600, correct=T),
              message = 'There are 600 total participants.'),
     question_numeric("How many participants preferred not to disclose their gender?",
              answer(10, correct=T),
              message = '10 participants chose not to disclose their gender.'),
     question_numeric("What is the mean well-being score? Please round your answer to two decimal places.",
              answer(18.20, correct=T),
              message = 'The mean score on the well-being scale is 18.20.'))
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>


## Check Assumptions

You can remember the requirements/assumptions of linear regression by remembering **LINE**.

(1) **L**inearity: All predictors variables have a linear relationship with the outcome variable.

(2) **I**ndependence of Observations: Individual observations should not be dependent upon any others

(3) **N**ormality: Model residuals are normally distributed

(4) **E**qual Variance (AKA Homoskedasticity or Homogeneity of Variance): the variance is consistent across both predictor values & fitted values

(5) No Multicol**line**arity: Predictors should not be highly correlated with each other (e.g., $r$ > .8)

### Your Tasks

+ [ ] $\ $ Decide whether your data meet the assumption of linearity

+ [ ] $\ $ Decide whether your data meet the assumption of normality

+ [ ] $\ $ Decide whether your data meet the assumption of equal variance

+ [ ] $\ $ Check whether your data exhibit multicollinearity

You can assume independence is met, as it's something that's accounted for through good study design rather than statistically.

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint here.

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Primary Analysis

As you are testing whether multiple predictor variables can predict a single, continuous outcome, you'll use results from Multiple Linear regression to provide statistical support for your hypotheses.


### Your Tasks

+ [ ] $\ $ Run multiple regression to test your hypotheses and interpret the overall model results with $\alpha$ = .05.

+ [ ] $\ $ Interpret the individual predictor results with $\alpha$ = .05.

+ [ ] $\ $ Compute the confidence intervals associated with each predictor

```{r cyrAnalysis, echo = FALSE}
quiz(caption = 'Check Your Results',
     question_numeric("How much variance in well-being is explained by your predictors? Please provide your answer as a percentage (without the % sign), and round it to the nearest whole number.",
              answer(36, correct=T),
              message = 'The three predictor variables explain ~36% of the variance in well-being scores (see the adjusted R square value).'),
     question("Which of the following are significant predictors of well-being? Please select all that apply.",
              answer('Sleep', correct=T),
              answer('Physical Activity'),
              answer('Social Support', correct = T),
              message = 'Both sleep and social support are significant predictors of well-being. The p-value associated with Physical Activity was .239, which is larger than our alpha threshold of .05, so this variable is not considered significant.',
              random_answer_order = T),
     question('The overall model is significant.',
              answer('True', correct = T),
              answer('False'),
              message = 'The overall model test produced an F-statistic of 112.21 and a corresponding p-value of < .001. This suggests that our combination of predictor variables significantly predict the scores on our well-being assessment.'))
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Power Analysis

Click [here to use WebPower to run your analysis](https://webpower.psychstat.org/wiki/models/index).

### Your Task

+ [ ] $\ $ Run a **sensitivity** power analysis using $\alpha$ = .05 and power = .8 to determine the effect size ($R^2$) you're capable of detecting with 600 participants using a linear regression model with 3 predictors.

+ [ ] $\ $ Convert the $f^2$ value to $R^2$ using the following formula:

$$R^2 = \frac{f^2}{f^2+1}$$

#### Bonus Task

+ [ ] $\ $ Run an a priori power analysis using $\alpha$ = .05 and power = .8 to determine the number of participants you need to detect a moderate effect ($R^2$ = .13) with a linear regression using 3 predictors. You can use the following formula to convert $R^2$ to $f^2$:

$$f^2 = \frac{R^2}{1-R^2}$$



```{r cyrPower, echo = FALSE}
quiz(caption = 'Check Your Results',
     question_numeric("What is the R2 value associated with your sensitivity power analysis (i.e., what R2 value are you capable of detecting with 600 participants)? Please round your answer to 2 decimal places.",
              answer(.02, correct=T),
              message = "You are capable of detecting an R2 value of .02. The power analysis produced an f2 value of .02. You can get this result by converting this value to R2 with the following equation: .02/(.02+1) = .02. In this case, it's basically identical, but this may not always be the case."),
     question_numeric("How many participants do you need to detect an R2 of .13 with 3 predictors?",
                      answer(77, correct = T),
                      message = 'First, you need to convert R2 to f2 using the following equation: .13/(1-.13) = .15. Using this effect size, the power calculation indicates that 77 participants are needed to detect this effect with 80% power and alpha = .05.'))
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>


## Interpret & Report 

Now that you've completed the analyses, write a mini results section describing your findings. In this section, please:

+ Give a brief description of your sample as you would in a methods section. 

+ Report your results and a provide interpretation in APA style. 


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

There are many ways you could write this up, but you should at least include the following information:

+ alpha level
+ number of participants (n)
+ participant demographics (mean age, age $SD$, and age range of sample; gender distribution of sample)
+ descriptive data for each variable ($M$ & $SD$)
+ the type of test used
+ $R^2$ and its interpretation
+ the overall model test results ($F$, $df$, $p$)
+ individual predictor results (either $B$ or $\beta$, appropriate interpretation, confidence intervals, $p$ values)

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

