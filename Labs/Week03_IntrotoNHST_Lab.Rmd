---
title: "Week 3: Intro to NHST"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
    css: https://mtruelovehill.github.io/PRM/Labs/css/style.css
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(kableExtra)
library(knitr)
library(shiny)
library(shinyjs)
library(bslib)
library(pwr)

baseColor <- '#4CA384'
accent1 <- '#9AD079'
accent2 <- '#C4C6C7'
accent3 <- '#19424C'
#tutorial_options(exercise.timelimit = 60)

dat <- read.csv('https://mtruelovehill.github.io/PRM/Labs/Week1LabData.csv')
```

```{r, context = 'server'}
output$aucPlot <- renderPlot({
  loLim <- ifelse(input$auc[1]==0, .00001, input$auc[1])
  hiLim <- ifelse(input$auc[2]==1, .999999, input$auc[2])
  
  ggplot(data.frame(x=c(-6, 6)), aes(x)) + 
    stat_function(fun=dnorm, geom = "line", linewidth = 1.5) +
    geom_area(stat = "function", fun = dnorm, fill = baseColor, xlim = c(qnorm(loLim), qnorm(hiLim)),
              alpha = .7) + 
    theme(axis.text = element_blank(),
          axis.ticks = element_blank(),
          axis.title = element_blank()) +
    annotate('text', label = paste0((input$auc[2]-input$auc[1])*100, '% of observations'),
             x = -3, y = .3, size = 6)
    })


output$aucScorePlot <- renderPlot({
  loLim <- ifelse(input$score[1]==38, 38, input$score[1])
  hiLim <- ifelse(input$score[2]==78, 78, input$score[2])
  

  propVal <- round((pnorm(input$score[2], mean = 58, sd = 9.4)-pnorm(input$score[1], mean = 58, sd = 9.4))*100)
  
  ggplot(data.frame(x=c(38, 78)), aes(x)) +
    stat_function(fun=dnorm, geom = "line", linewidth = 1.5, args = c(mean = 58, sd = 9.4)) +
    geom_area(stat = "function", fun = dnorm, fill = baseColor, args = c(mean = 58, sd = 9.4), xlim = c(loLim, hiLim),
              alpha = .7) +
    theme(axis.text = element_blank(),
          axis.ticks = element_blank(),
          axis.title = element_blank()) +
    annotate('text', label = paste0(propVal, '% of observations'), x = 60, y = .02, size = 6)
    })

output$effectSizePlot <- renderPlot({
  pooledSD <- sqrt(((25-1)*input$sdG1^2 + (25-1)*input$sdG2^2) / (25+25-2))
  
  ggplot(data.frame(x=c(15, 85)), aes(x)) +
    stat_function(fun=dnorm, geom = "line", linewidth = 1.5, args = c(mean = input$meanG1, sd = input$sdG1)) +
    stat_function(fun=dnorm, geom = "line", linewidth = 1.5, args = c(mean = input$meanG2, sd = input$sdG2)) +
    scale_y_continuous(limits = c(0, .4)) +
    geom_area(stat = "function", fun = dnorm, fill = baseColor, args = c(mean = input$meanG1, sd = input$sdG1),
              alpha = .7) +
    geom_area(stat = "function", fun = dnorm, fill = accent1, args = c(mean = input$meanG2, sd = input$sdG2),
              alpha = .7) + 
    annotate(geom = 'text', label = paste('Effect Size =', round(abs(input$meanG1-input$meanG2)/pooledSD, 2)), 
             x = 25, y = .19, size = 7) +
    theme(axis.text.x = element_text(size = 12),
          axis.title.x = element_text(size = 14, face = 'bold'),
          axis.text.y = element_blank(),
          axis.title.y = element_blank(),
          axis.ticks.y = element_blank())
  
})
```

## Intro to Today's Lab

During today's lab, you'll apply the concepts discussed during this week's lecture. You'll also review a few concepts from last week's lecture. Each lab consists of a range of tasks, with corresponding questions you can answer. Please note that the questions are not required and not marked, although they do provide a helpful source of formative feedback that will help you gauge your understanding. 

Today, you'll be using interactive visualisations to demonstrate the concepts covered in the lecture. You'll also work with the dataset you created last week.

### Learning Objectives
At the end of this lab, you will be able to:

1. Understand the link between probability and inferential statistics
2. Describe the difference between effect sizes and $p$-values
3. Compute confidence intervals
4. Describe general requirements of a power analysis

## Computing the Area Under the Curve

Some kind of introduction to this idea here.

```{r aucPlot, echo = F}

tags$style(HTML(".js-irs-0 .irs-single, .js-irs-0 .irs-bar-edge, .js-irs-0 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-1 .irs-single, .js-irs-1 .irs-bar-edge, .js-irs-1 .irs-bar {background: #4CA384}"))

sliderInput('auc', 'Thresholds:', min=0, max = 1, step = .01, value = c(0,1), ticks = F)
plotOutput('aucPlot')

```

Now that you've started to get a grasp on what the area under the curve corresponds to, let's apply this to the data from last week.
Recall that you have 45 students who completed each of the four assessments. Imagine that the plot below reflects the probability distribution of performance on Assessment A. Use this plot to answer the following questions:

THIS IS OLD; SHOULD TAKE OUT: Imagine that you have a sample of 250 students who took the Wechsler Adult Intelligence Scale-IV (WAIS-IV). Imagine that the plot below reflects the probability distribution of your sample. 

```{r, echo = F}
sliderInput('score', 'Assessment C Score:', min=38, max = 78, step = 1, value = c(38,78), ticks = F)
plotOutput('aucScorePlot')
```


```{r q1, echo = FALSE}

quiz(caption = 'Test Your Understanding',
     question_numeric('What is the percentage of the sample who score between 95 and 110 on the WAIS?',
                      answer(38, correct = T),
                      message = '38% of the sample scored between 95 and 110.'),
     question_numeric('What percentage of the sample scored 87 or lower?',
                      answer(19, correct = T),
                      message = '19% of the sample received a score 87 or lower.'),
     question_numeric('If you wanted to isolate the 10% of your sample with the lowest scores, what cut-off score would you use?',
                      answer(81, correct = T),
                      message = 'The lowest 10% of the sample scored below 81.'),
     question_numeric('Participant J scored 127. Fill in the blank: __% of the sample received a score at least as high as Participant J.',
                      answer(4, correct = T),
                      message = 'Only 4% of the sample scored at least 127')
)
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>



## Identifying the &alpha; cutoff

PLOTS WHERE alpha is set to .05, .01 and .001
Need both nondirectional and directional plots

Task Description.

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Computing <i> p </i>

Task Description.

```{r q3, echo = FALSE}
# quiz(caption = 'Test Your Understanding',
#      question("Which of the following central tendency measures could be used to describe age? Please select all that apply.",
#               answer("Mean", correct = T),
#               answer("Median", correct = T),
#               answer('Mode', correct = T),
#               message = 'All of the above could technically be used to describe the Age variable. However, it is most common to use the
#               mean, as it includes information from each observation.'),
#      question("Which of the following central tendency measures could be used to describe gender? Please select all that apply.",
#               answer("Mean"),
#               answer("Median"),
#               answer('Mode', correct = T),
#               message = 'As a categorical variable, there is no numeric relationship between values in the gender variable. Therefore, 
#               the mode is the only measure of central tendency that is appropriate to describe this variable'),
#      question_numeric("What is the average score on Assessment A?",
#               answer(39.10, correct=T)),
#      question_numeric("What is the most common age in this sample?",
#               answer(19, correct=T)),
#      question_numeric("What is the median score on Assessment D?",
#               answer(81.87, correct=T))
# )
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Putting it all Together

Task Description.

```{r q4, echo = FALSE}
# quiz(caption = 'Test Your Understanding',
#      question("Which of the following central tendency measures could be used to describe age? Please select all that apply.",
#               answer("Mean", correct = T),
#               answer("Median", correct = T),
#               answer('Mode', correct = T),
#               message = 'All of the above could technically be used to describe the Age variable. However, it is most common to use the
#               mean, as it includes information from each observation.'),
#      question("Which of the following central tendency measures could be used to describe gender? Please select all that apply.",
#               answer("Mean"),
#               answer("Median"),
#               answer('Mode', correct = T),
#               message = 'As a categorical variable, there is no numeric relationship between values in the gender variable. Therefore, 
#               the mode is the only measure of central tendency that is appropriate to describe this variable'),
#      question_numeric("What is the average score on Assessment A?",
#               answer(39.10, correct=T)),
#      question_numeric("What is the most common age in this sample?",
#               answer(19, correct=T)),
#      question_numeric("What is the median score on Assessment D?",
#               answer(81.87, correct=T))
# )
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>


## Interpreting Effect Sizes

MAYBE COMPARING DIFFERENCES BETWEEN ASSESSMENT SCORES

```{r effSizePlot, echo = F}

tags$style(HTML(".js-irs-2 .irs-single, .js-irs-2 .irs-bar-edge, .js-irs-2 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-3 .irs-single, .js-irs-3 .irs-bar-edge, .js-irs-3 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-4 .irs-single, .js-irs-4 .irs-bar-edge, .js-irs-4 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-5 .irs-single, .js-irs-5 .irs-bar-edge, .js-irs-5 .irs-bar {background: #4CA384}"))

fluidRow(column(6,
                sliderInput('meanG1', 'Group 1 Mean', min=30, max = 70, step = 1, value = 50, ticks = F),
                sliderInput('sdG1', 'Group 1 SD', min=1, max = 10, step = 1, value = 2.5, ticks = F),
                style='padding-left:50px; padding-right:10px; padding-bottom: 0px; padding-top: 0px'),
  column(6, sliderInput('meanG2', 'Group 2 Mean', min=30, max = 70, step = 1, value = 50, ticks = F),
         sliderInput('sdG2', 'Group 2 SD', min=1, max = 10, step = 1, value = 2.5, ticks = F), style='padding-left:50px; padding-right:30px; padding-bottom: 0px; padding-top: 0px'))


plotOutput('effectSizePlot')
```

```{r q5, echo = FALSE}

quiz(caption = 'Test Your Understanding',
     question("If the means differ but are held constant, what happens to the effect size when one group's SD is increased?",
              answer('The effect size increases'),
              answer('The effect size decreases', correct = T),
              answer('The effect size stays the same'),
              message = 'Increasing the standard deviation of one group will decrease the effect size. This is because the variability in the data are increased'))

# quiz(caption = 'Test Your Understanding',
#      question("At least one of the groups is limited in size compared to the others",
#               answer("True", correct = T),
#               answer("False"),
#               message = 'The nonbinary group is much smaller than the other two measured groups.'),
#      question_numeric("How many total datapoints do you have for the gender variable?",
#               answer(48, correct=T)),
#      question_numeric("What percentage of participants are female?",
#               answer(41.7, correct=T)),
#      question_numeric('How many nonbinary participants are in your sample?',
#               answer(2, correct=T)))
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Compute a 95% Confidence Interval 

Task Here

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>


## Power Analyses

An a priori power analysis should be conducted when designing the study in order to determine the number of participants needed to detect the effect of interest. To run an a priori power analysis, you will need (at minimum) a power threshold, an alpha value, and an estimated effect size. 

In this course, we'll be using [WebPower](https://webpower.psychstat.org/wiki/models/index) to conduct our power analyses. We'll begin to conduct power analyses when we run specific statistical tests. Today, we'll focus on improving your understanding of the concept of statistical power. Have a look at the following power curves and spend some time trying to interpret them.

```{r, echo = F, fig.width = 8, fig.height=4}

powerDat <- read.csv('https://mtruelovehill.github.io/PRM/Data/powerDat.csv')
powerDat$EffectSize <- factor(powerDat$EffectSize, levels = c('strong', 'moderate', 'weak'))

(powPlot <- ggplot(powerDat, aes(SampleSize, Power, color = EffectSize)) + geom_point() +
  labs(x = 'Sample Size', y = 'Power', color = 'Effect Size') +
  scale_x_continuous(breaks = seq(0, 200, by = 20)) +
  scale_y_continuous(breaks = seq(0, 1, by = .1)) +
  scale_color_manual(values = c(accent3, accent1, baseColor), labels = c('Strong', 'Moderate', 'Weak')) +
  theme(axis.text = element_text(size = 14),
        axis.title = element_text(size = 16, face = 'bold'),
        legend.title = element_text(size = 14, face = 'bold'),
        legend.text = element_text(size = 12)))
```

### Your Task

As you interpret this plot, try to answer the following questions:

+ What is the effect of sample size on power?

+ What is the effect of effect size on power?

+ About how many participants are necessary to detect a moderate effect with 80% power? 

+ If you expect a weak effect but have only 50 participants, what is your likelihood of making a Type II error?

```{r q9, echo = FALSE}
 quiz(caption = 'Test Your Understanding',
      question('What is the traditional threshold for power that is considered accdeptable?',
               answer('70%'),
               answer('80%', correct = T),
               answer('90%'),
               answer('100%'),
               message = 'Traditionally, a threshold of 80% is considered an acceptable level of power for a study.'),
      question('Which of the following is not considered when calculating power?',
               answer('Sample variance', correct = T),
               answer('Sample size'),
               answer('Significance level'),
               answer('Effect size'),
               random_answer_order = T,
               message = 'Power is affected by the significance level, sample size, and effect size. Each of these four values is a function of the remaining three.'),
      question('Which of the following would lead to an increase in statistical power? Please select all that apply.',
               answer('Decreasing alpha'),
               answer('Increasing effect size', correct = T),
               answer('Using a two-tailed test instead of a one-tailed test'),
               answer('Increasing the number of participants in the sample', correct = T),
               random_answer_order = T,
               message = 'Power has a positive relationship with all of the given values, so that as effect size, sample size, and alpha increase, so too does power. Decreasing any of these lowers power. Going from a one-tailed to a two-tailed test decreases alpha by splitting it between each tail, so this would also lower power.'),
      question('You run a power analysis and find that, for your analysis, you will need 136 participants to have 80% power to detect a moderate effect (d = .5). Which of the following statements are true? Please select all that apply.',
               answer('If you recruit fewer than 136 participants, your chances of detecting an existing effect will decrease.', correct = T),
               answer('If you recruit at least 136 participants, you have an 80% chance of getting statistically significant results.'),
               answer('If you recruit 136 participants, you have a 20% chance of making a Type II error.', correct = T),
               answer('If the actual effect in the population is weaker than d = .5, 136 participants will still provide sufficient power to detect it.'),
               answer('If the actual effect in the population is stronger than d = .5, 136 participants will still provide sufficient power to detect it.', correct = T),
               random_answer_order = T,
               message = 'You only have an 80% chance of getting statistically significant results IF the effect actually exists. Additionally, reducing the effect size decreases power, so you will need to increase your sample size in order to detect a smaller effect. Increasing the effect size increases power, so you will still be sufficiently powered to detect a larger effect without changing the sample.')
      )
```


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

&beta;: the likelihood of making a Type II error

Power = 1 - &beta;

</details>
</div>

</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

<i><b> What is the effect of sample size on power? What is the effect of effect size on power? </i></b>

The sample size values can be found on the x-axis of the plot. As these values increase, you can see that power increases as well. Each line represents a different effect size strength. A strong effect size provides more power than a moderate effect size, which provides more power than a weak effect size. 

</br>
<i><b> About how many participants are necessary to detect a moderate effect with 80% power? </i></b>

```{r, echo = F, fig.width=6, fig.height=3}
powPlot + 
  geom_segment(x = 0, xend = 63, y = .8, yend = .8, linetype = 'dashed') +
  geom_segment(x = 63, xend = 63, y = 0, yend = .8, linetype = 'dashed') +
  geom_point(x = 63, y = .8, shape = 8, size = 2)
```

If we check the line associated with moderate strength, we can see that we need about 63 participants to achieve a power of 80%.

</br>

<i><b> If you expect a weak effect but have only 50 participants, what is your likelihood of making a Type II error? </i></b>

```{r, echo = F, fig.width=6, fig.height=3}
powPlot + 
  geom_segment(x = 0, xend = 50, y = .16, yend = .16, linetype = 'dashed') +
  geom_segment(x = 50, xend = 50, y = 0, yend = .16, linetype = 'dashed') +
  geom_point(x = 50, y = .16, shape = 8, size = 2)
```

By checking the line associated with a weak effect size, we can see that 50 participants is associated with a power of about .16. To calculate the chances of making a Type II error using our power value, we need to subtract .16 from 1. This leaves us with .84, meaning we have about an 84% chance of making a Type II error. In other words, we have a high likelihood of failing to identify an existing effect.

</details>
</div>
</br>


## Report and Interpret

Now that you've evaluated the assessments, write a paragraph with your results that you could present to the instructor, giving them a suggestion of which assessment they should use in their course. In this paragraph, please do the following: 

+ Describe your sample as you would in a methods section. 

+ Provide a recommendation for which exam the instructor should use in their course, using your results to support your suggestion.

Make sure to use APA style. Once you're finished, compare your paragraph to the solution paragraph. Is there anything you included that is not in the solution? Is there anything you left out? Does your suggestion match the solution paragraph? If not, why not?

</br>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

<span style = "color:white">You might find the <span style = "color:#9AD079"> [Purdue Owl website](https://owl.purdue.edu/owl/research_and_citation/apa_style/apa_formatting_and_style_guide/general_format.html) </span> helpful for APA formatting. See the participants/sample section in <span style = "color:#9AD079"> [this paper](https://journals.sagepub.com/doi/full/10.1177/0956797620939054) </span> for an example of how you might describe your sample. You can see other examples <span style = "color:#9AD079"> [here](https://journals.sagepub.com/doi/full/10.1177/09567976241231572) </span> and <span style = "color:#9AD079"> [here](https://www.sciencedirect.com/science/article/pii/S0022103123001439)</span>.

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

For this analysis, we examined results from 4 different assessments in an attempt to identify the one that most accurately captures the range of student abilities. Each of the 4 assessments was presented 15 students in each of the instructor's 3 courses, providing a total sample of 45 students between ages 17 and 52 ($M$ = 23.04, $SD$ = 7.74; 25 male, 19 female, and 2 nonbinary participants).

Student performance varied widely between the assessments (see Table 1).

**Table 1**

*Assessment Scores - Descriptive Data*

```{r, echo = F, out.width='70%'}

knitr::include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/week1_10a.PNG')

```


As the average score on Assessment A corresponded to a failing mark, this assessment is not recommended. Conversely, the average score on Assessment B was quite high. Additionally, the data exhibited a negative skew. This suggests that there is a ceiling effect, as most students are scoring close to the maximum possible score (see Figure 1).

</br>

**Figure 1**

*Assessment B Scores*

```{r, echo = F, message = F, warning=FALSE}
ggplot(dat, aes(B)) + geom_histogram(fill=baseColor, color = accent3, binwidth = 2) +
  labs(x='Score', y='Count') +
  scale_x_continuous(breaks=seq(0, 100, 10), limits = c(0,100)) +
  theme(axis.title = element_text(size = 16, face = 'bold'),
        axis.text = element_text(size = 14),
        panel.background = element_blank(),
        axis.line = element_line())
```

*Note.* You cannot produce this figure with SPSS. This is just here to show you an example of an appropriate way to report your results with an APA-style figure.

</br>

Assessments D's average was still too high, and the standard deviation of scores was quite small, indicating that it may not be accurately capturing the variability in student comprehension (see Figure 2).

</br>

**Figure 2**

*Assessment D Scores*

```{r, echo = F, message = F, warning=FALSE}
ggplot(dat, aes(D)) + geom_histogram(fill=baseColor, color = accent3, binwidth = 2) +
  labs(x='Score', y='Count') +
  scale_x_continuous(breaks=seq(0, 100, 10), limits = c(0,100)) +
  theme(axis.title = element_text(size = 16, face = 'bold'),
        axis.text = element_text(size = 14),
        panel.background = element_blank(),
        axis.line = element_line())
```

</br>

Assessment C had a reasonable average, as well as higher variability in the range of scores (see Figure 3). This indicates that, of these assessments, Assessment C may best capture the range of student abilities within the course.

</br>

**Figure 3**

*Assessment C Scores*

```{r, echo = F, message = F, warning=FALSE}
ggplot(dat, aes(C)) + geom_histogram(fill=baseColor, color = accent3, binwidth = 2) +
  labs(x='Score', y='Count') +
  scale_x_continuous(breaks=seq(0, 100, 10), limits = c(0,100)) +
  theme(axis.title = element_text(size = 16, face = 'bold'),
        axis.text = element_text(size = 14),
        panel.background = element_blank(),
        axis.line = element_line())
```

</details>
</div>



</br>
</br>