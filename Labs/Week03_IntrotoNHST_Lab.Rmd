---
title: "Week 3: Intro to NHST"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: true
    css: https://mtruelovehill.github.io/PRM/Labs/css/style.css
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(kableExtra)
library(knitr)
library(shiny)
library(shinyjs)
library(bslib)

baseColor <- '#4CA384'
accent1 <- '#9AD079'
accent2 <- '#C4C6C7'
accent3 <- '#19424C'
#tutorial_options(exercise.timelimit = 60)
```

```{r, context = 'server'}
output$aucPlot <- renderPlot({
  loLim <- ifelse(input$auc[1]==0, .00001, input$auc[1])
  hiLim <- ifelse(input$auc[2]==1, .999999, input$auc[2])
  
  ggplot(data.frame(x=c(-6, 6)), aes(x)) + 
    stat_function(fun=dnorm, geom = "line", linewidth = 1.5) +
    geom_area(stat = "function", fun = dnorm, fill = baseColor, xlim = c(qnorm(loLim), qnorm(hiLim)),
              alpha = .7) + 
    theme(axis.text = element_blank(),
          axis.ticks = element_blank(),
          axis.title = element_blank()) +
    annotate('text', label = paste0((input$auc[2]-input$auc[1])*100, '% of observations'),
             x = -3, y = .3, size = 6)
    })


output$aucScorePlot <- renderPlot({
  loLim <- ifelse(input$score[1]==50, 50, input$score[1])
  hiLim <- ifelse(input$score[2]==150, 150, input$score[2])
  

  propVal <- round((pnorm(input$score[2], mean = 100, sd = 15)-pnorm(input$score[1], mean = 100, sd = 15))*100)
  
  ggplot(data.frame(x=c(50, 150)), aes(x)) +
    stat_function(fun=dnorm, geom = "line", linewidth = 1.5, args = c(mean = 100, sd = 15)) +
    geom_area(stat = "function", fun = dnorm, fill = baseColor, args = c(mean = 100, sd = 15), xlim = c(loLim, hiLim),
              alpha = .7) +
    theme(axis.text = element_blank(),
          axis.ticks = element_blank(),
          axis.title = element_blank()) +
    annotate('text', label = paste0(propVal, '% of observations'), x = 140, y = .02, size = 6)
    })

```

## Intro to Today's Lab

During today's lab, you'll apply the concepts discussed during this week's lecture. Each lab consists of 10 tasks, with corresponding questions you can answer. Please note that the questions are not required and not marked, although they do provide a helpful source of formative feedback that will help you gauge your understanding. 

Intro Goes Here   

```{r, echo = F}
# dat <- read.csv('Week1LabData.csv')
# datInfo <- data.frame(VariableName=colnames(dat), 
#                       Description=c('Participant ID', 'Age in years', 'Time of class in which assessment was given', 'Levels: 1=Male,
#                                     2=Females, 3=Nonbinary', 'Assessment Version A Scores', 'Assessment Version B Scores', 'Assessment 
#                                     Version C Scores', 'Assessment Version D Scores'))
# 
# datInfo %>%
#   kbl(col.names=c('Variable Name', 'Description')) %>%
#   kable_styling(full_width = F) %>%
#   row_spec(0, bold = T, color=baseColor, font_size = 18, align='l') %>%
#   column_spec(1, bold = T, width = '4.5cm')
```


### Learning Objectives
At the end of this lab, you will be able to:

1. Describe requirements of a general power analysis
2. Understand the link between probability and inferential statistics
3. Describe the difference between effect sizes and p-values
4. Compute confidence intervals



## Power Analysis

An a priori power analysis should be conducted when designing the study in order to determine the number of participants needed to detect the effect of interest. In this course, we'll be using [WebPower](https://webpower.psychstat.org/wiki/models/index) to conduct our power analyses. We'll begin to conduct power analyses when we run specific statistical tests. For today, we'll focus on improving your understanding of the concept of statistical power. Have a look at the following power curves and spend some time trying to interpret them.



You run a power analysis and find that, for your analysis, you will need 136 participants to have 80% power to detect a moderate effect (d = .5). Which of the following statements are true? Please select all that apply.

+ 

+ 

+ 

+ 

+ 


```{r q1, echo = FALSE}
 quiz(caption = 'Test Your Understanding',
      question('What is the traditional threshold for power that is considered accdeptable?',
               answer('70%'),
               answer('80%', correct = T),
               answer('90%'),
               answer('100%'),
               message = 'Traditionally, a threshold of 80% is considered an acceptable level of power for a study.'),
      question('Which of the following is not considered when calculating power?',
               answer('Sample variance', correct = T),
               answer('Sample size'),
               answer('Significance level'),
               answer('Effect size'),
               random_answer_order = T,
               message = 'Power is affected by the significance level, sample size, and effect size. Each of these four values is a function of the remaining three.'),
      question('Which of the following would lead to an increase in statistical power? Please select all that apply.',
               answer('Decreasing alpha'),
               answer('Increasing effect size', correct = T),
               answer('Using a two-tailed test instead of a one-tailed test'),
               answer('Increasing the number of participants in the sample', correct = T),
               random_answer_order = T,
               message = 'Power has a positive relationship with all of the given values, so that as effect size, sample size, and alpha increase, so too does power. Decreasing any of these lowers power. Going from a one-tailed to a two-tailed test decreases alpha by splitting it between each tail, so this would also lower power.'),
      question('You run a power analysis and find that, for your analysis, you will need 136 participants to have 80% power to detect a moderate effect (d = .5). Which of the following statements are true? Please select all that apply.',
               answer('If you recruit fewer than 136 participants, your chances of detecting an existing effect will decrease.', correct = T),
               answer('If you recruit at least 136 participants, you have an 80% chance of getting statistically significant results.'),
               answer('If you recruit 136 participants, you have a 20% chance of making a Type II error.', correct = T),
               answer('If the actual effect in the population is weaker than d = .5, 136 participants will still provide sufficient power to detect it.'),
               answer('If the actual effect in the population is stronger than d = .5, 136 participants will still provide sufficient power to detect it.', correct = T),
               random_answer_order = T,
               message = 'You only have an 80% chance of getting statistically significant results IF the effect actually exists. Additionally, reducing the effect size decreases power, so you will need to increase your sample size in order to detect a smaller effect. Increasing the effect size increases power, so you will still be sufficiently powered to detect a larger effect without changing the sample.')
      )
```

You can download today's data onto your device by <B>[clicking here](https://mtruelovehill.github.io/PRM/Labs/Week1LabData.csv)</B> or checking this week's folder on Learn (requires university login). 

### Your Task
Import 'Week2LabData.csv' into SPSS.




<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Check under the **File** tab in SPSS. What is the difference between the 'Open' and 'Import Data' options?

</details>
</div>

</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>
Click *Import Data* under the **File** tab. The data are in .csv format, so choose *CSV Data*. Navigate to the folder where you've stored  'Week1LabData.csv' and select the file.

```{r, echo = F, out.width='50%'}
include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/week1_1a.png')
```

A box will pop up that allows you to review the data before import. In this example, the first row of our data is the name for each column, so the 'First line contains variable names' should remain checked. Note that if you import data without column names, you'll need to uncheck this box. Click 'OK'.

```{r, echo = F, out.width='60%'}
include_graphics('https://mtruelovehill.github.io/PRM/Labs/images/week1_1b.PNG')
```


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Goes Here

</details>
</div>
</br>

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution Goes Here

</details>
</div>
</br>

## Calculating the Area Under the Curve

Some kind of introduction to this idea here.

```{r aucPlot, echo = F}
sliderInput('auc', 'Thresholds:', min=0, max = 1, step = .01, value = c(0,1), ticks = F)
plotOutput('aucPlot')

# fluidRow(column(4,
#   sliderInput("lo","Low Threshold:", min = -6, max = 6, value = 0, step = 2),
#   sliderInput('hi', 'High Threshold:', min = 1, max = 5, value = 1, step = .25)),
#   column(8, plotOutput('distPlot')))
#
tags$style(HTML(".js-irs-0 .irs-single, .js-irs-0 .irs-bar-edge, .js-irs-0 .irs-bar {background: #4CA384}"))
tags$style(HTML(".js-irs-1 .irs-single, .js-irs-1 .irs-bar-edge, .js-irs-1 .irs-bar {background: #4CA384}"))

```

Now that you've started to get a grasp on what the area under the curve corresponds to, let's apply this to a practical example. Imagine that you have a sample of 250 participants who took the Wechsler Adult Intelligence Scale-IV (WAIS-IV). Imagine that the plot below reflects the probability distribution of your sample. Use this plot to answer the following questions:

```{r, echo = F}
sliderInput('score', 'WAIS-IV Score:', min=50, max = 150, step = 1, value = c(50,150), ticks = F)
plotOutput('aucScorePlot')
```


```{r q2, echo = FALSE}

quiz(caption = 'Test Your Understanding',
     question_numeric('What is the percentage of the sample who score between 95 and 110 on the WAIS?',
                      answer(38, correct = T),
                      message = '38% of the sample scored between 95 and 110.'),
     question_numeric('What percentage of the sample scored 87 or lower?',
                      answer(19, correct = T),
                      message = '19% of the sample received a score 87 or lower.'),
     question_numeric('If you wanted to isolate the 10% of your sample with the lowest scores, what cut-off score would you use?',
                      answer(81, correct = T),
                      message = 'The lowest 10% of the sample scored below 81.'),
     question_numeric('Participant J scored 127. Fill in the blank: __% of the sample received a score at least as high as Participant J.',
                      answer(4, correct = T),
                      message = 'Only 4% of the sample scored at least 127')
)
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>


## Evaluating Type I & Type II Errors


Task Description Here

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>




## Interpreting Effect Sizes

Task Here.

Plot that the effect size can be manipulated. So two groups, that, as the means grow further apart, the effect size gets larger, etc.

```{r q4, echo = FALSE}
# quiz(caption = 'Test Your Understanding',
#      question("At least one of the groups is limited in size compared to the others",
#               answer("True", correct = T),
#               answer("False"),
#               message = 'The nonbinary group is much smaller than the other two measured groups.'),
#      question_numeric("How many total datapoints do you have for the gender variable?",
#               answer(48, correct=T)),
#      question_numeric("What percentage of participants are female?",
#               answer(41.7, correct=T)),
#      question_numeric('How many nonbinary participants are in your sample?',
#               answer(2, correct=T)))
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Compute a 95% Confidence Interval 

Task Here

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Task 6: 

Task Description.

```{r q6, echo = FALSE}
# quiz(caption = 'Test Your Understanding',
#      question("Which of the following central tendency measures could be used to describe age? Please select all that apply.",
#               answer("Mean", correct = T),
#               answer("Median", correct = T),
#               answer('Mode', correct = T),
#               message = 'All of the above could technically be used to describe the Age variable. However, it is most common to use the
#               mean, as it includes information from each observation.'),
#      question("Which of the following central tendency measures could be used to describe gender? Please select all that apply.",
#               answer("Mean"),
#               answer("Median"),
#               answer('Mode', correct = T),
#               message = 'As a categorical variable, there is no numeric relationship between values in the gender variable. Therefore, 
#               the mode is the only measure of central tendency that is appropriate to describe this variable'),
#      question_numeric("What is the average score on Assessment A?",
#               answer(39.10, correct=T)),
#      question_numeric("What is the most common age in this sample?",
#               answer(19, correct=T)),
#      question_numeric("What is the median score on Assessment D?",
#               answer(81.87, correct=T))
# )
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Task 7: 

Task here.

```{r q7, echo = FALSE}
# quiz(caption = 'Test Your Understanding',
#      question_numeric("What is the IQR for Assessment B?",
#               answer(4, correct=T),
#               message = "To get the IQR for a variable, you'll need to subtract the 25th percentile from the 75th percentile."),
#      question_numeric("What is the maximum score on Assessment C?",
#               answer(78, correct=T)),
#      question_numeric("What is the standard deviation of scores on Assessment D? Please report your answer to two decimal places.",
#               answer(2.15, correct=T))
# )
```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

## Task 8: 

Task here.

```{r distPlot, echo = F}
# 
# fluidRow(column(4, 
#   sliderInput("mean","Value of Mean:", min = -6, max = 6, value = 0, step = 2),
#   sliderInput('sd', 'Value of SD:', min = 1, max = 5, value = 1, step = .25)),
#   column(8, plotOutput('distPlot')))
# 
# tags$style(HTML(".js-irs-0 .irs-single, .js-irs-0 .irs-bar-edge, .js-irs-0 .irs-bar {background: #4CA384}"))
# tags$style(HTML(".js-irs-1 .irs-single, .js-irs-1 .irs-bar-edge, .js-irs-1 .irs-bar {background: #4CA384}"))

```

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>


## Power Analyses

In this course, we'll use [WebPower](https://webpower.psychstat.org/wiki/models/index) to perform power analyses. 

<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>


## Interpret & Report 

Task here.


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for a hint </span></summary>

Hint Here

</details>
</div>
</br>


<div class="container">
<details><summary><span style = "font-weight: bold; font-size: 16pt"> Click here for the solution </span></summary>

Solution here.

</details>
</div>
</br>

